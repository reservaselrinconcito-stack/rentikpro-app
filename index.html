<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RentikPro</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Load sql.js for SQLite support (local vendored for offline/desktop) -->
  <script src="/vendor/sqljs/sql-wasm.js"></script>

  <!-- PWA & Mobile Optimization (Block ICON) -->
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#4f46e5">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="RentikPro">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-192.png">

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    .glass-morphism {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
  </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.13.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.563.0",
    "tesseract.js": "https://esm.sh/tesseract.js@^7.0.0"
  }
}
</script>
  <link rel="stylesheet" href="/index.css">
</head>

<body class="bg-slate-50 text-slate-900">
  <div id="root"></div>

  <!-- Fatal Error Overlay System (S2) -->
  <script>
    (function () {
      function showFatalError(title, message, stack) {
        const root = document.getElementById('root');
        const overlayId = 'rentikpro-fatal-error';
        if (document.getElementById(overlayId)) return;

        const overlay = document.createElement('div');
        overlay.id = overlayId;
        overlay.style = 'position:fixed;top:0;left:0;width:100%;height:100%;background:#F8FAFC;z-index:999999;display:flex;align-items:center;justify-content:center;padding:24px;font-family:sans-serif;';

        const card = document.createElement('div');
        card.className = 'glass-morphism';
        card.style = 'background:white;padding:40px;border-radius:32px;box-shadow:0 25px 50px -12px rgba(0,0,0,0.1);max-width:600px;width:100%;border:1px solid #fee2e2;';

        card.innerHTML = `
          <div style="width:64px;height:64px;background:#fee2e2;color:#ef4444;border-radius:20px;display:flex;align-items:center;justify-content:center;margin-bottom:24px;">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          </div>
          <h1 style="font-size:24px;font-weight:900;color:#1e293b;margin:0 0 8px 0;letter-spacing:-0.5px;">${title}</h1>
          <p style="color:#64748b;font-size:14px;margin-bottom:24px;line-height:1.6;">Ha ocurrido un error crítico que impide iniciar la aplicación en este navegador.</p>
          
          <div style="background:#f1f5f9;padding:16px;border-radius:16px;margin-bottom:24px;border:1px solid #e2e8f0;overflow:hidden;">
            <div style="font-size:10px;font-weight:900;color:#94a3b8;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Detalles técnicos</div>
            <div style="font-family:monospace;font-size:12px;color:#ef4444;word-break:break-all;max-height:150px;overflow-y:auto;">
              <strong>${message}</strong>
              <pre style="margin-top:8px;color:#64748b;white-space:pre-wrap;">${stack || 'No stack trace available'}</pre>
            </div>
            <div style="font-size:10px;color:#94a3b8;margin-top:12px;padding-top:8px;border-top:1px solid #e2e8f0;">
              UA: ${navigator.userAgent}
            </div>
          </div>

          <div style="display:grid;grid-template-cols:1fr 1fr;gap:12px;">
            <button onclick="window.location.reload()" style="background:#4f46e5;color:white;border:none;padding:14px;border-radius:16px;font-weight:700;cursor:pointer;font-size:14px;">Recargar</button>
            <button onclick="window.emergencyReset()" style="background:white;color:#64748b;border:1px solid #e2e8f0;padding:14px;border-radius:16px;font-weight:700;cursor:pointer;font-size:14px;">Reset Local</button>
          </div>
        `;

        overlay.appendChild(card);
        document.body.appendChild(overlay);
      }

      window.emergencyReset = function () {
        if (confirm('¿Deseas limpiar la sesión local? Esto no borrará tus datos permanentes, solo el ID del proyecto activo.')) {
          localStorage.removeItem('active_project_id');
          localStorage.removeItem('active_project_mode');
          window.location.reload();
        }
      };

      window.onerror = function (msg, url, lineNo, columnNo, error) {
        showFatalError('Error de Carga', msg, error?.stack);
        return false;
      };

      window.onunhandledrejection = function (event) {
        showFatalError('Error asíncrono', event.reason?.message || 'Promesa rechazada', event.reason?.stack);
      };

      console.log("[Bootstrap] Error Monitor Active");
    })();
  </script>

  <script type="module" src="/index.tsx"></script>
</body>

</html>
